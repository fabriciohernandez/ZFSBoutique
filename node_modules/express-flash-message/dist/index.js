"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.flash = function (options) { return function (req, response, next) {
    if (!req.session) {
        throw new Error('no session detected!');
    }
    var keyName = options ? (options.sessionKeyName ? options.sessionKeyName : 'flash') : 'flash';
    req.flash = function (event, message) {
        return new Promise(function (res, rej) {
            if (!req.session[keyName]) {
                req.session[keyName] = {};
            }
            if (!req.session[keyName][event]) {
                req.session[keyName][event] = [];
            }
            req.session[keyName][event].push(message);
            req.session.save(function (err) {
                if (err) {
                    return rej(err);
                }
                res();
            });
        });
    };
    req.consumeFlash = function (event) {
        return new Promise(function (res, rej) {
            var messages = [];
            if (req.session[keyName] && req.session[keyName][event]) {
                messages = req.session[keyName][event].slice();
                req.session[keyName] = null;
            }
            req.session.save(function (err) {
                if (err) {
                    return rej(err);
                }
                res(messages);
            });
        });
    };
    next();
}; };
